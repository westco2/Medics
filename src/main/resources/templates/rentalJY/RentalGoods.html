<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rental Request Form</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.0.0/fonts/remixicon.css" rel="stylesheet">
</head>
<body>
</style>
</head>
<body>
    <h2>대여물품</h2>
    <form id="searchForm">
        <label for="itemName">물품명:</label>
        <input type="text" id="itemName" name="itemName" required>
        <button type="submit">검색</button>
    </form>
    <h3>대여신청</h3>
    <div style="display: flex;">
        <form action="/rental-requests/submit" method="post">
            <label for="selectedItem">물품명:</label>
            <input type="text" id="selectedItem" name="selectedItem" readonly>

            <label for="selectedItemCode">물품코드:</label>
            <input type="text" id="selectedItemCode" name="selectedItemCode" readonly>

            <label for="customerName">학번:</label>
            <input type="text" id="customerName" name="customerName" readonly>

            <label for="quantity">수량:</label>
            <input type="number" id="quantity" name="quantity" required min="1">

            <label for="rentalDateTime">대여일시:</label>
            <input type="datetime-local" id="rentalDateTime" name="rentalDateTime" required>

            <label for="phoneNumber">연락처:</label>
            <input type="tel" id="phoneNumber" name="phoneNumber" required><br>
            <button type="submit">대여 신청</button>
        </form>

        <div id="searchResult">
            <h3>물품 리스트</h3>
            <ul id="itemList"></ul>
        </div>
    </div>

    <script>
        // 사용자 데이터에서 학번 가져오기
        const customerNameInput = document.getElementById('customerName');
        // 이 부분은 사용자 데이터에서 학번을 가져와서 출력하는 코드입니다.
        // 예를 들어 세션에서 학번을 가져와서 출력하는 코드를 여기에 추가하면 됩니다.
        // 아래는 예시 코드입니다.
        const studentId = '<%= session.getAttribute("studentId") %>';
        customerNameInput.value = studentId;

        const searchForm = document.getElementById('searchForm');
        const selectedItemInput = document.getElementById('selectedItem');
        const selectedItemCodeInput = document.getElementById('selectedItemCode');

        searchForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const itemName = document.getElementById('itemName').value;

            fetch(`/rental-items/search?name=${itemName}`)
                .then(response => response.json())
                .then(data => {
                    const itemList = document.getElementById('itemList');
                    itemList.innerHTML = ''; // 기존 목록 초기화
                    data.forEach(item => {
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `
                            <input type="checkbox" id="itemCheckbox_${item.code}" value="${item.name}" name="selectedItemCheckbox">
                            <label for="itemCheckbox_${item.code}">NO</label>
                            <span>${item.code}</span>
                            <span>${item.name}</span>
                            <span>재고: ${item.quantity}</span>
                            <span>대여여부: ${item.rentalStatus}</span>
                            <span>예약수: ${item.reservationCount}</span>
                        `;
                        listItem.addEventListener('click', function() {
                            selectedItemInput.value = item.name;
                            selectedItemCodeInput.value = item.code;
                        });
                        itemList.appendChild(listItem);
                    });
                })
                .catch(error => console.error('Error fetching rental items:', error));
        });
    </script>
</body>
</html>